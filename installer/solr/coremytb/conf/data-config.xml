<dataConfig>
    <dataSource type="JdbcDataSource"
                driver="com.mysql.jdbc.Driver"
                url="jdbc:mysql://mysqldb:3306/mytb"
                user="mytb"
                password="mytb"/>
    <document>
        <entity name="track"
                pk="id"
                query="select 'TRACK' as type, concat('ac_', kategorie_full.k_type) as actiontype, concat('ac_', kategorie_full.k_type) as subtype, concat('TRACK', '_', kategorie_full.k_id) as id, kategorie_full.k_id, kategorie_full.t_id, kategorie_full.k_t_ids, kategorie_full.tr_id, kategorie_full.l_id, n_id, k_name, k_html, concat(k_html, ' ', k_name, ' ', k_keywords, ' ', k_meta_shortdesc_md, ' ', l_lochirarchietxt) as html, k_dateshow, k_datevon as datesort, k_datevon, DATE_FORMAT (k_datevon, GET_FORMAT(DATE, 'ISO')) as dateonly, week(k_datevon) AS week, month(k_datevon) as month, year(k_datevon) as year, k_gpstracks_basefile, k_keywords, k_meta_shortdesc_md, k_meta_shortdesc_html, k_meta_shortdesc_html as k_meta_shortdesc_html2, k_rate_gesamt, k_gps_lat, k_gps_lon, concat(k_gps_lat, ',', k_gps_lon) as k_gps_loc, l_lochirarchietxt, l_lochirarchieids, `K_ALTITUDE_ASC` as altAsc, `K_ALTITUDE_DESC` as altDesc, `K_ALTITUDE_MIN` as altMin, `K_ALTITUDE_MAX` as altMax, `K_DISTANCE` as dist, `K_RATE_AUSDAUER` as ausdauer, `K_RATE_BILDUNG` as bildung, `K_RATE_GESAMT` as gesamt, `K_RATE_KRAFT` as kraft, `K_RATE_MENTAL` as mental, `K_RATE_MOTIVE` as motive, `K_RATE_SCHWIERIGKEIT` as schwierigkeit, `K_RATE_WICHTIGKEIT` as wichtigkeit, round((K_ALTITUDE_ASC / 500))*500 as altAscFacet, round((K_ALTITUDE_MAX / 500))*500 as altMaxFacet, round((K_DISTANCE / 5))*5 as distFacet, TIME_TO_SEC(TIMEDIFF(K_DATEBIS, K_DATEVON))/3600 as dur, ROUND(ROUND(TIME_TO_SEC(TIMEDIFF(K_DATEBIS, K_DATEVON))/3600 * 2) / 2, 1) as durFacet from kategorie_full, location where kategorie_full.l_id = location.l_id order by k_datevon"
                deltaImportQuery="select 'TRACK' as type, concat('ac_', kategorie_full.k_type) as actiontype, concat('ac_', kategorie_full.k_type) as subtype, concat('TRACK', '_', kategorie_full.k_id) as id, kategorie_full.k_id, kategorie_full.t_id, kategorie_full.k_t_ids, kategorie_full.l_id, n_id, k_name, k_html, concat(k_html, ' ', k_name, ' ', k_keywords, ' ', k_meta_shortdesc_md, ' ', l_lochirarchietxt) as html, k_dateshow, k_datevon as datesort, k_datevon, DATE_FORMAT (k_datevon, GET_FORMAT(DATE, 'ISO')) as dateonly, week(k_datevon) AS month, month(k_datevon) as month, year(k_datevon) as year, k_gpstracks_basefile, k_keywords, k_meta_shortdesc_md, k_meta_shortdesc_html, k_meta_shortdesc_html as k_meta_shortdesc_html2, k_rate_gesamt, k_gps_lat, k_gps_lon, concat(k_gps_lat, ',', k_gps_lon) as k_gps_loc, l_lochirarchietxt, l_lochirarchieids, `K_ALTITUDE_ASC` as altAsc, `K_ALTITUDE_DESC` as altDesc, `K_ALTITUDE_MIN` as altMin, `K_ALTITUDE_MAX` as altMax, `K_DISTANCE` as dist, `K_RATE_AUSDAUER` as ausdauer, `K_RATE_BILDUNG` as bildung, `K_RATE_GESAMT` as gesamt, `K_RATE_KRAFT` as kraft, `K_RATE_MENTAL` as mental, `K_RATE_MOTIVE` as motive, `K_RATE_SCHWIERIGKEIT` as schwierigkeit, `K_RATE_WICHTIGKEIT` as wichtigkeit, round((K_ALTITUDE_ASC / 500))*500 as altAscFacet, round((K_ALTITUDE_MAX / 500))*500 as altMaxFacet, round((K_DISTANCE / 5))*5 as distFacet, TIME_TO_SEC(TIMEDIFF(K_DATEBIS, K_DATEVON))/3600 as dur, ROUND(ROUND(TIME_TO_SEC(TIMEDIFF(K_DATEBIS, K_DATEVON))/3600 * 2) / 2, 1) as durFacet from kategorie_full, location where kategorie_full.l_id = location.l_id and kategorie_full.k_id='${dih.delta.id}'"
                deltaQuery="SELECT k_id from kategorie_full'"
                transformer="HTMLStripTransformer,RegexTransformer"
        >
            <field column="id" name="id"/>
            <field column="k_id" name="track_id_i"/>
            <field column="k_id" name="track_id_is"/>
            <field column="tr_id" name="trip_id_i"/>
            <field column="tr_id" name="trip_id_is"/>
            <field column="t_id" name="route_id_i"/>
            <field column="t_id" name="route_id_is"/>
            <field column="l_id" name="loc_id_i"/>
            <field column="n_id" name="news_id_i"/>
            <field column="n_id" name="news_id_is"/>

            <field column="k_name" name="name_s" stripHTML="true" />
            <field column="k_name" name="name_txt" stripHTML="true" />
            <field column="html" name="html_txt" stripHTML="true" />
            <field column="k_meta_shortdesc_html" name="desc_txt" stripHTML="true" />
            <field column="k_meta_shortdesc_md" name="desc_md_txt" stripHTML="true" />
            <field column="k_meta_shortdesc_html2" name="desc_html_txt" />
            <field column="k_keywords" name="keywords_txt" regex="[ ]+" replaceWith=" " />
            <field column="k_gpstracks_basefile" name="gpstracks_basefile_s" />
            <field column="k_datevon" name="date_dt" />
            <field column="k_dateshow" name="dateshow_dt" />
            <field column="datesort" name="datesort_dt" />
            <field column="dateonly" name="dateonly_s" />
            <field column="k_datevon" name="date_dts" />
            <field column="week" name="week_is" />
            <field column="month" name="month_is" />
            <field column="year" name="year_is" />
            <field column="k_gps_lat" name="geo_lat_s" />
            <field column="k_gps_lon" name="geo_lon_s" />
            <field column="k_gps_loc" name="geo_loc_p" type="location" />
            <field column="type" name="type_s" />
            <field column="type" name="type_txt" />
            <field column="actiontype" name="actiontype_s" />
            <field column="actiontype" name="actiontype_ss" />
            <field column="subtype" name="subtype_s" />
            <field column="subtype" name="subtype_ss" />
            <field column="l_lochirarchieids" name="loc_lochirarchie_ids_s" regex="[ ]+" replaceWith="_"/>
            <field column="l_lochirarchieids" name="loc_lochirarchie_ids_txt" regex="[ ]+" replaceWith="_"/>
            <field column="l_lochirarchietxt" name="loc_lochirarchie_s" regex="[- \/()+;\.]+(?!\\\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
            <field column="l_lochirarchietxt" name="loc_lochirarchie_txt" regex="[- \/()+;\.]+(?!\\\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
            <field column="altAsc" name="data_tech_alt_asc_i" />
            <field column="altDesc" name="data_tech_alt_desc_i" />
            <field column="altMin" name="data_tech_alt_min_i" />
            <field column="altMax" name="data_tech_alt_max_i" />
            <field column="dist" name="data_tech_dist_f" />
            <field column="dur" name="data_tech_dur_f" />
            <field column="altAscFacet" name="data_tech_alt_asc_facet_is" />
            <field column="altMaxFacet" name="data_tech_alt_max_facet_is" />
            <field column="distFacet" name="data_tech_dist_facets_fs" />
            <field column="durFacet" name="data_tech_dur_facet_fs" />
            <field column="ausdauer" name="rate_pers_ausdauer_i" />
            <field column="bildung" name="rate_pers_bildung_i" />
            <field column="gesamt" name="rate_pers_gesamt_i" />
            <field column="kraft" name="rate_pers_kraft_i" />
            <field column="mental" name="rate_pers_mental_i" />
            <field column="motive" name="rate_pers_motive_i" />
            <field column="schwierigkeit" name="rate_pers_schwierigkeit_i" />
            <field column="wichtigkeit" name="rate_pers_wichtigkeit_i" />
            <field column="gesamt" name="rate_pers_gesamt_is" />
            <field column="schwierigkeit" name="rate_pers_schwierigkeit_is" />

            <!-- child='true' -->
            <entity name='image'
                    query="select i_id, i_date, concat(i_dir, '/', i_file) as i_url from image where k_id='${track.k_id}' order by I_RATE_MOTIVE desc, I_RATE_WICHTIGKEIT desc, I_RATE desc, I_ID desc limit 10"
                    deltaImportQuery="SELECT i_id, i_date, concat(i_dir, '/', i_file) as i_url from image WHERE i_id='${dih.delta.id}'"
                    deltaQuery="SELECT i_id from image'"
            >
                <field column="i_id" name="i_fav_id_is" />
                <field column="i_date" name="i_fav_i_date_dts" />
                <field column="i_url" name="i_fav_url_txt" />
            </entity>
            <entity name='tour'
                    query="select t_id from tour where find_in_set(t_id, '${track.k_t_ids}') > 0"
                    deltaImportQuery="select t_id from tour where t_id='${dih.delta.id}'"
                    deltaQuery="SELECT t_id from tour'"
            >
                <field column="t_id" name="route_id_is"/>
            </entity>
        </entity>

        <entity name="route"
                pk="id"
                query="select 'ROUTE' as type, concat('ac_', tour.t_typ) as actiontype, concat('ac_', tour.t_typ) as subtype, concat('ROUTE', '_', tour.t_id) as id, tour.k_id, tour.t_id, tour.l_id, t_name, t_html_list, concat(t_html_list, ' ', t_name, ' ', t_keywords, ' ', t_meta_shortdesc_md, ' ', l_lochirarchietxt) as html, t_dateshow, t_datevon as datesort, t_datevon, DATE_FORMAT (t_datevon, GET_FORMAT(DATE, 'ISO')) as dateonly, t_gpstracks_basefile, t_keywords, t_meta_shortdesc_md, t_meta_shortdesc_html, t_meta_shortdesc_html as t_meta_shortdesc_html2, t_rate_gesamt, t_gps_lat, t_gps_lon, concat(t_gps_lat, ',', t_gps_lon) as t_gps_loc, l_lochirarchietxt, l_lochirarchieids, t_k_ids, `T_ELE_MAX` as altMax, `T_ROUTE_HM` as altAsc, `T_ROUTE_M` as dist, `T_ROUTE_DAUER` as dur, `T_RATE` as overall, `T_RATE_KS` as ks, `T_RATE_FIRN` as firn, `T_RATE_GLETSCHER` as gletscher, `T_RATE_KLETTERN` as klettern, `T_RATE_BERGTOUR` as bergtour, `T_RATE_SCHNEESCHUH` as schneeschuh, `T_RATE_AUSDAUER` as ausdauer, `T_RATE_BILDUNG` as bildung, `T_RATE_GESAMT` as gesamt, `T_RATE_KRAFT` as kraft, `T_RATE_MENTAL` as mental, `T_RATE_MOTIVE` as motive, `T_RATE_SCHWIERIGKEIT` as schwierigkeit, `T_RATE_WICHTIGKEIT` as wichtigkeit, round((T_ROUTE_HM / 500))*500 as altAscFacet, round((T_ELE_MAX / 500))*500 as altMaxFacet, round((T_ROUTE_M / 5))*5 as distFacet, ROUND(ROUND(T_ROUTE_DAUER * 2) / 2, 1) as durFacet, T_DESC_FUEHRER_FULL as guides, T_DESC_GEBIET as region, T_DESC_TALORT as baseloc, T_DESC_ZIEL as destloc from tour, location where tour.l_id = location.l_id order by t_datevon, t_id"
                deltaImportQuery="select 'ROUTE' as type, concat('ROUTE', '_', tour.t_id) as id, tour.k_id, tour.t_id, tour.l_id, t_name, t_html_list, concat(t_html_list, ' ', t_name, ' ', t_keywords, ' ', t_meta_shortdesc_md, ' ', l_lochirarchietxt) as html, t_dateshow, t_datevon as datesort, t_datevon, DATE_FORMAT (t_datevon, GET_FORMAT(DATE, 'ISO')) as dateonly, t_gpstracks_basefile, t_keywords, t_meta_shortdesc_md, t_meta_shortdesc_html, t_meta_shortdesc_html as t_meta_shortdesc_html2, t_rate_gesamt, t_gps_lat, t_gps_lon, concat(t_gps_lat, ',', t_gps_lon) as t_gps_loc, l_lochirarchietxt, l_lochirarchieids, t_k_ids, `T_ELE_MAX` as altMax, `T_ROUTE_HM` as altAsc, `T_ROUTE_M` as dist, `T_ROUTE_DAUER` as dur, `T_RATE` as overall, `T_RATE_KS` as ks, `T_RATE_FIRN` as firn, `T_RATE_GLETSCHER` as gletscher, `T_RATE_KLETTERN` as klettern, `T_RATE_BERGTOUR` as bergtour, `T_RATE_SCHNEESCHUH` as schneeschuh, `T_RATE_AUSDAUER` as ausdauer, `T_RATE_BILDUNG` as bildung, `T_RATE_GESAMT` as gesamt, `T_RATE_KRAFT` as kraft, `T_RATE_MENTAL` as mental, `T_RATE_MOTIVE` as motive, `T_RATE_SCHWIERIGKEIT` as schwierigkeit, `T_RATE_WICHTIGKEIT` as wichtigkeit, round((T_ROUTE_HM / 500))*500 as altAscFacet, round((T_ELE_MAX / 500))*500 as altMaxFacet, round((T_ROUTE_M / 5))*5 as distFacet, ROUND(ROUND(T_ROUTE_DAUER * 2) / 2, 1) as durFacet, T_DESC_FUEHRER_FULL as guides, T_DESC_GEBIET as region, T_DESC_TALORT as baseloc, T_DESC_ZIEL as destloc from tour, location where tour.l_id = location.l_id and tour.t_id='${dih.delta.id}'"
                deltaQuery="SELECT T_id from tour order by t_datevon, t_id'"
                transformer="HTMLStripTransformer,RegexTransformer"
        >
            <field column="id" name="id"/>
            <field column="k_id" name="track_id_i"/>
            <field column="k_id" name="track_id_is"/>
            <field column="t_id" name="route_id_i"/>
            <field column="t_id" name="route_id_is"/>
            <field column="l_id" name="loc_id_i"/>

            <field column="t_name" name="name_s" stripHTML="true" />
            <field column="t_name" name="name_txt" stripHTML="true" />
            <field column="html" name="html_txt" stripHTML="true" />
            <field column="t_meta_shortdesc_html" name="desc_txt" stripHTML="true" />
            <field column="t_meta_shortdesc_md" name="desc_md_txt" stripHTML="true" />
            <field column="t_meta_shortdesc_html2" name="desc_html_txt" />
            <field column="t_keywords" name="keywords_txt" regex="[ ]+" replaceWith=" " />
            <field column="t_gpstracks_basefile" name="gpstracks_basefile_s" />
            <field column="dateonly" name="dateonly_s" />
            <field column="t_datevon" name="date_dt" />
            <field column="t_dateshow" name="dateshow_dt" />
            <field column="datesort" name="datesort_dt" />
            <field column="t_gps_lat" name="geo_lat_s" />
            <field column="t_gps_lon" name="geo_lon__s" />
            <field column="t_gps_loc" name="geo_loc_p" type="location" />
            <field column="type" name="type_s" />
            <field column="type" name="type_txt" />
            <field column="actiontype" name="actiontype_s" />
            <field column="actiontype" name="actiontype_ss" />
            <field column="subtype" name="subtype_s" />
            <field column="subtype" name="subtype_ss" />
            <field column="l_lochirarchieids" name="loc_lochirarchie_ids_s" regex="[ ]+" replaceWith="_"/>
            <field column="l_lochirarchieids" name="loc_lochirarchie_ids_txt" regex="[ ]+" replaceWith="_"/>
            <field column="l_lochirarchietxt" name="loc_lochirarchie_s" regex="[- \/()+;\.]+(?!\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
            <field column="l_lochirarchietxt" name="loc_lochirarchie_txt" regex="[- \/()+;\.]+(?!\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
            <field column="altMax" name="data_tech_alt_max_i" />
            <field column="altAsc" name="data_tech_alt_asc_i" />
            <field column="dist" name="data_tech_dist_f" />
            <field column="dur" name="data_tech_dur_f" />
            <field column="guides" name="data_info_guides_s" />
            <field column="region" name="data_info_region_s" />
            <field column="destloc" name="data_info_destloc_s" />
            <field column="baseloc" name="data_info_baseloc_s" />
            <field column="altAscFacet" name="data_tech_alt_asc_facet_is" />
            <field column="altMaxFacet" name="data_tech_alt_max_facet_is" />
            <field column="distFacet" name="data_tech_dist_facets_fs" />
            <field column="durFacet" name="data_tech_dur_facet_fs" />
            <field column="overall" name="rate_tech_overall_s" />
            <field column="ks" name="rate_tech_ks_s" />
            <field column="firn" name="rate_tech_firn_s" />
            <field column="gletscher" name="rate_tech_gletscher_s" />
            <field column="klettern" name="rate_tech_klettern_s" />
            <field column="bergtour" name="rate_tech_bergtour_s" />
            <field column="schneeschuh" name="rate_tech_schneeschuh_s" />
            <field column="overall" name="rate_tech_overall_ss" regex="[^-a-zA-Z0-9+.äöüßÄÖÜ]+" replaceWith=" "/>
            <field column="ausdauer" name="rate_pers_ausdauer_i" />
            <field column="bildung" name="rate_pers_bildung_i" />
            <field column="gesamt" name="rate_pers_gesamt_i" />
            <field column="kraft" name="rate_pers_kraft_i" />
            <field column="mental" name="rate_pers_mental_i" />
            <field column="motive" name="rate_pers_motive_i" />
            <field column="schwierigkeit" name="rate_pers_schwierigkeit_i" />
            <field column="wichtigkeit" name="rate_pers_wichtigkeit_i" />
            <field column="gesamt" name="rate_pers_gesamt_is" />
            <field column="schwierigkeit" name="rate_pers_schwierigkeit_is" />

            <!-- child='true' -->
            <entity name='image'
                    query="select image.i_id, i_date, concat(i_dir, '/', i_file) as i_url from image, kategorie_full where image.k_id=kategorie_full.k_id and (image.k_id in (${route.t_k_ids} 0) or image.k_id in (${route.k_id}) or find_in_set(${route.t_id}, k_t_ids) > 0) and (I_IMAGE_OBJECTS is null or length(I_IMAGE_OBJECTS) &lt; 5) order by I_RATE_MOTIVE desc, I_RATE_WICHTIGKEIT desc, I_RATE desc, image.I_ID desc limit 10"
                    deltaImportQuery="SELECT i_id, i_date, concat(i_dir, '/', i_file) as i_url from image WHERE i_id='${dih.delta.id}'"
                    deltaQuery="SELECT i_id from image'"
            >
                <field column="i_id" name="i_fav_id_is" />
                <field column="i_date" name="i_fav_i_date_dts" />
                <field column="i_url" name="i_fav_url_txt" />
            </entity>
            <entity name='bericht'
                    query="select k_id, tr_id, n_id, k_dateshow, k_datevon, week(k_datevon) AS week, month(k_datevon) as month, year(k_datevon) as year from kategorie_full where k_id in (${route.t_k_ids} 0) or k_id in (${route.k_id}) or find_in_set(${route.t_id}, k_t_ids) > 0 order by k_datevon asc"
                    deltaImportQuery="select tr_id, k_dateshow, k_datevon, week(k_datevon) AS week, month(k_datevon) as month, year(k_datevon) as year from kategorie_full where k_id=dih.delta.id}'"
                    deltaQuery="SELECT k_id from kategorie_full'"
            >
                <field column="tr_id" name="trip_id_is"/>
                <field column="n_id" name="news_id_is"/>
                <field column="k_id" name="track_id_is"/>
                <field column="k_datevon" name="date_dts" />
                <field column="week" name="week_is" />
                <field column="month" name="month_is" />
                <field column="year" name="year_is" />
            </entity>
        </entity>

        <entity name="location"
                pk="id"
                query="select 'LOCATION' as type, concat('loc_', location.l_typ) as subtype, concat('LOCATION', '_', l_id) as id, l_id, l_parent_id, l_name, l_html, l_meta_shortdesc_md, l_meta_shortdesc_html, l_meta_shortdesc_html as l_meta_shortdesc_html2, concat(l_html, ' ', l_name, ' ', l_keywords, ' ', l_meta_shortdesc_md, ' ', l_lochirarchietxt) as html, l_gps_lat, l_gps_lon, concat(l_gps_lat, ',', l_gps_lon) as l_gps_loc, l_lochirarchietxt, l_lochirarchieids, l_katids, l_tids, l_keywords from location order by l_typ asc, l_name"
                deltaImportQuery="select 'LOCATION' as type, concat('LOCATION', '_', l_id) as id, l_id, l_name, l_html, l_meta_shortdesc_md, l_meta_shortdesc_html, l_meta_shortdesc_html as l_meta_shortdesc_html2, concat(l_html, ' ', l_name, ' ', l_keywords, ' ', l_meta_shortdesc_md, ' ', l_lochirarchietxt) as html, l_gps_lat, l_gps_lon, concat(l_gps_lat, ',', l_gps_lon) as l_gps_loc, l_lochirarchietxt, l_lochirarchieids, l_katids, l_tids, l_keywords from location WHERE l_id='${dih.delta.id}'"
                deltaQuery="SELECT l_id from location order by l_typ asc, l_id'"
                transformer="HTMLStripTransformer,RegexTransformer"
        >
            <field column="id" name="id"/>
            <field column="l_id" name="loc_id_i"/>
            <field column="l_parent_id" name="loc_parent_id_i"/>

            <field column="l_name" name="name_s" stripHTML="true" />
            <field column="l_name" name="name_txt" stripHTML="true" />
            <field column="html" name="html_txt" stripHTML="true" />
            <field column="l_meta_shortdesc_html" name="desc_txt" stripHTML="true" />
            <field column="l_meta_shortdesc_md" name="desc_md_txt" stripHTML="true" />
            <field column="l_meta_shortdesc_html2" name="desc_html_txt" />
            <field column="l_keywords" name="keywords_txt" regex="[ ]+" replaceWith=" " />
            <field column="l_gps_lat" name="geo_lat_s" />
            <field column="l_gps_lon" name="geo_lon_s" />
            <field column="l_gps_loc" name="geo_loc_p" type="location" />
            <field column="type" name="type_s" />
            <field column="type" name="type_txt" />
            <field column="subtype" name="subtype_s" />
            <field column="subtype" name="subtype_ss" />
            <field column="l_lochirarchieids" name="loc_lochirarchie_ids_s" regex="[ ]+" replaceWith="_"/>
            <field column="l_lochirarchieids" name="loc_lochirarchie_ids_txt" regex="[ ]+" replaceWith="_"/>
            <field column="l_lochirarchietxt" name="loc_lochirarchie_s" regex="[- \/()+;\.]+(?!\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
            <field column="l_lochirarchietxt" name="loc_lochirarchie_txt" regex="[- \/()+;\.]+(?!\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>

            <!-- child='true' -->
            <entity name='image'
                    query="select i_id, i_date, concat(i_dir, '/', i_file) as i_url from image where k_id in (${location.l_katids} 0) and (I_IMAGE_OBJECTS is null or length(I_IMAGE_OBJECTS) &lt; 5) order by I_RATE_MOTIVE desc, I_RATE_WICHTIGKEIT desc, I_RATE desc, I_ID desc limit 10"
                    deltaImportQuery="SELECT i_id, i_date, concat(i_dir, '/', i_file) as i_url from image WHERE i_id='${dih.delta.id}'"
                    deltaQuery="SELECT i_id from image'"
            >
                <field column="i_id" name="i_fav_id_is" />
                <field column="i_date" name="i_fav_i_date_dts" />
                <field column="i_url" name="i_fav_url_txt" />
            </entity>

            <entity name='tour'
                    query="select t_id, t_keywords, concat('ac_', tour.t_typ) as actiontype from tour where t_id in (${location.l_tids} 0)"
                    deltaImportQuery="select t_id, t_keywords from tour where t_id='${dih.delta.id}'"
                    deltaQuery="SELECT t_id from tour'"
            >
                <field column="t_keywords" name="keywords_txt" regex="[ ]+" replaceWith=" " />
                <field column="actiontype" name="actiontype_s" />
                <field column="actiontype" name="actiontype_ss" />
            </entity>
            <entity name='bericht'
                    query="select tr_id, k_dateshow, k_datevon, week(k_datevon) AS week, month(k_datevon) as month, year(k_datevon) as year from kategorie_full where k_id in (${location.l_katids} 0) order by k_datevon asc"
                    deltaImportQuery="select tr_id, k_dateshow, k_datevon, week(k_datevon) AS week, month(k_datevon) as month, year(k_datevon) as year from kategorie_full where k_id=dih.delta.id}'"
                    deltaQuery="SELECT k_id from kategorie_full'"
            >
                <field column="tr_id" name="trip_id_is"/>
                <field column="k_datevon" name="date_dts" />
                <field column="week" name="week_is" />
                <field column="month" name="month_is" />
                <field column="year" name="year_is" />
            </entity>

        </entity>
        <entity name="image"
                pk="id"
                query="select 'IMAGE' as type, concat('ac_', kategorie_full.k_type) as actiontype, concat('ac_', kategorie_full.k_type) as subtype, concat('IMAGE', '_', image.i_id) as id, concat(i_dir, '/', i_file) as i_url, image.i_id, image.k_id, kategorie_full.tr_id, kategorie_full.n_id, image.t_id, kategorie_full.l_id, k_name, i_katname, i_katdesc, concat(i_katdesc, ' ', k_name, ' ', i_keywords, ' ', k_meta_shortdesc_md, ' ', l_lochirarchietxt) as html, week(i_date) AS week, month(i_date) as month, year(i_date) as year, i_dateshow, i_date as datesort, i_date, DATE_FORMAT (i_date, GET_FORMAT(DATE, 'ISO')) as dateonly, k_gpstracks_basefile, i_keywords, k_meta_shortdesc_md, k_meta_shortdesc_html, k_meta_shortdesc_html as k_meta_shortdesc_html2, i_rate, i_gps_lat, i_gps_lon, concat(i_gps_lat, ',', i_gps_lon) as i_gps_loc, l_lochirarchietxt, l_lochirarchieids, `I_GPS_ELE` as altMax, `I_RATE` as gesamt, `I_RATE_MOTIVE` as motive, `I_RATE_WICHTIGKEIT` as wichtigkeit, round((I_GPS_ELE / 500))*500 as altMaxFacet from image, kategorie_full, location where kategorie_full.l_id = location.l_id and image.k_id = kategorie_full.k_id order by i_date, i_id"
                deltaImportQuery="select 'IMAGE' as type, concat('ac_', kategorie_full.k_type) as actiontype, concat('ac_', kategorie_full.k_type) as subtype, concat('IMAGE', '_', image.i_id) as id, concat(i_dir, '/', i_file) as i_url, image.i_id, image.k_id, kategorie_full.n_id, image.t_id, kategorie_full.l_id, k_name, i_katname, i_katdesc, concat(i_katdesc, ' ', k_name, ' ', k_meta_shortdesc_md) as html, week(i_date) AS week, month(i_date) as month, year(i_date) as year, i_dateshow, i_date as datesort, i_date, DATE_FORMAT (i_date, GET_FORMAT(DATE, 'ISO')) as dateonly, k_gpstracks_basefile, i_keywords, k_meta_shortdesc_md, k_meta_shortdesc_html, k_meta_shortdesc_html as k_meta_shortdesc_html2, i_rate, i_gps_lat, i_gps_lon, concat(i_gps_lat, ',', i_gps_lon) as i_gps_loc, l_lochirarchietxt, l_lochirarchieids, `I_GPS_ELE` as altMax, `I_RATE` as gesamt, `I_RATE_MOTIVE` as motive, `I_RATE_WICHTIGKEIT` as wichtigkeit, round((I_GPS_ELE / 500))*500 as altMaxFacet from image, kategorie_full, location where kategorie_full.l_id = location.l_id and image.k_id = kategorie_full.k_id and image.i_id='${dih.delta.id}'"
                deltaQuery="SELECT i_id from image order by i_date, i_id'"
                transformer="HTMLStripTransformer,RegexTransformer"
        >
            <field column="id" name="id"/>
            <field column="i_id" name="image_id_i"/>
            <field column="k_id" name="track_id_i"/>
            <field column="k_id" name="track_id_is"/>
            <field column="t_id" name="route_id_i"/>
            <field column="t_id" name="route_id_is"/>
            <field column="tr_id" name="trip_id_i"/>
            <field column="l_id" name="loc_id_i"/>
            <field column="n_id" name="news_id_i"/>
            <field column="n_id" name="news_id_is"/>

            <field column="k_name" name="name_s" stripHTML="true" />
            <field column="k_name" name="name_txt" stripHTML="true" />
            <field column="html" name="html_txt" stripHTML="true" />
            <field column="k_meta_shortdesc_html" name="desc_txt" stripHTML="true" />
            <field column="k_meta_shortdesc_md" name="desc_md_txt" stripHTML="true" />
            <field column="k_meta_shortdesc_html2" name="desc_html_txt" />
            <field column="i_keywords" name="keywords_txt" regex="[ ]+" replaceWith=" " />
            <field column="k_gpstracks_basefile" name="gpstracks_basefile_s" />
            <field column="i_gps_lat" name="geo_lat_s" />
            <field column="i_gps_lon" name="geo_lon_s" />
            <field column="i_gps_loc" name="geo_loc_p" type="location" />
            <field column="type" name="type_s" />
            <field column="type" name="type_txt" />
            <field column="actiontype" name="actiontype_s" />
            <field column="actiontype" name="actiontype_ss" />
            <field column="subtype" name="subtype_s" />
            <field column="subtype" name="subtype_ss" />
            <field column="l_lochirarchieids" name="loc_lochirarchie_ids_s" regex="[ ]+" replaceWith="_"/>
            <field column="l_lochirarchieids" name="loc_lochirarchie_ids_txt" regex="[ ]+" replaceWith="_"/>
            <field column="l_lochirarchietxt" name="loc_lochirarchie_s" regex="[- \/()+;\.]+(?!\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
            <field column="l_lochirarchietxt" name="loc_lochirarchie_txt" regex="[- \/()+;\.]+(?!\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
            <field column="dateonly" name="dateonly_s" />
            <field column="i_dateshow" name="dateshow_dt" />
            <field column="datesort" name="datesort_dt" />
            <field column="i_date" name="date_dt" />
            <field column="i_date" name="date_dts" />
            <field column="week" name="week_is" />
            <field column="month" name="month_is" />
            <field column="year" name="year_is" />
            <field column="i_id" name="i_fav_id_is" />
            <field column="i_date" name="i_fav_i_date_dts" />
            <field column="i_url" name="i_fav_url_txt" />
            <field column="altMax" name="data_tech_alt_max_i" />
            <field column="altMaxFacet" name="data_tech_alt_max_facet_is" />
            <field column="gesamt" name="rate_pers_gesamt_i" />
            <field column="motive" name="rate_pers_motive_i" />
            <field column="wichtigkeit" name="rate_pers_wichtigkeit_i" />
            <field column="gesamt" name="rate_pers_gesamt_is" />

        </entity>

        <entity name="trip"
                pk="id"
                query="select 'TRIP' as type, concat('TRIP', '_', tr_id) as id, tr_id, tr_dateshow, tr_datevon as datesort, tr_datevon, DATE_FORMAT (tr_datevon, GET_FORMAT(DATE, 'ISO')) as dateonly, TIME_TO_SEC(TIMEDIFF(tr_datebis, tr_datevon))/3600 as dur, tr_name, tr_meta_shortdesc_md, tr_meta_shortdesc_html, tr_meta_shortdesc_html as tr_meta_shortdesc_html2, concat(tr_name, ' ', tr_keywords, ' ', tr_meta_shortdesc_md) as html, tr_keywords from trip where tr_id in (select tr_id from kategorie_full) order by tr_datevon"
                deltaImportQuery="select 'TRIP' as type, concat('TRIP', '_', tr_id) as id, tr_id, tr_dateshow, tr_datevon as datesort, tr_datevon, DATE_FORMAT (tr_datevon, GET_FORMAT(DATE, 'ISO')) as dateonly, TIME_TO_SEC(TIMEDIFF(tr_datebis, tr_datevon))/3600 as dur, tr_name, tr_meta_shortdesc_md, tr_meta_shortdesc_html, tr_meta_shortdesc_html as tr_meta_shortdesc_html2, , concat(tr_name, ' ', tr_keywords, ' ', tr_meta_shortdesc_md) as html, tr_keywords from trip WHERE tr_id='${dih.delta.id}'"
                deltaQuery="SELECT tr_id from trip where tr_id in (select tr_id from kategorie_full) order by tr_id'"
                transformer="HTMLStripTransformer,RegexTransformer"
        >
            <field column="id" name="id"/>
            <field column="tr_id" name="trip_id_i"/>
            <field column="l_id" name="loc_id_i"/>

            <field column="tr_name" name="name_s" stripHTML="true" />
            <field column="tr_name" name="name_txt" stripHTML="true" />
            <field column="tr_meta_shortdesc_html" name="desc_txt" stripHTML="true" />
            <field column="tr_meta_shortdesc_md" name="desc_md_txt" stripHTML="true" />
            <field column="tr_meta_shortdesc_html2" name="desc_html_txt" />
            <field column="html" name="html_txt" stripHTML="true" />
            <field column="tr_keywords" name="keywords_txt" regex="[ ]+" replaceWith=" " />
            <field column="tr_dateshow" name="dateshow_dt" />
            <field column="datesort" name="datesort_dt" />
            <field column="tr_datevon" name="date_dt" />
            <field column="dateonly" name="dateonly_s" />
            <field column="type" name="type_s" />
            <field column="type" name="type_txt" />
<!--            <field column="dur" name="data_tech_dur_f" />   -->

            <!-- child='true' -->
            <entity name='image'
                    query="select i_id, i_date, concat(i_dir, '/', i_file) as i_url from image where k_id in (select k_id from kategorie_full where tr_id in (${trip.tr_id})) and (I_IMAGE_OBJECTS is null or length(I_IMAGE_OBJECTS) &lt; 5) order by I_RATE_MOTIVE desc, I_RATE_WICHTIGKEIT desc, I_RATE desc, I_ID desc limit 10"
                    deltaImportQuery="SELECT i_id, i_date, concat(i_dir, '/', i_file) as i_url from image WHERE i_id='${dih.delta.id}'"
                    deltaQuery="SELECT i_id from image'"
            >
                <field column="i_id" name="i_fav_id_is" />
                <field column="i_date" name="i_fav_i_date_dts" />
                <field column="i_url" name="i_fav_url_txt" />
            </entity>

            <entity name='tour'
                    query="select t_id, t_keywords, concat('ac_', tour.t_typ) as actiontype from tour where t_id in (select t_id from kategorie_full where tr_id in (${trip.tr_id}))"
                    deltaImportQuery="select t_id, t_keywords from tour where t_id='${dih.delta.id}'"
                    deltaQuery="SELECT t_id from tour'"
            >
                <field column="actiontype" name="actiontype_s" />
                <field column="actiontype" name="actiontype_ss" />
            </entity>
            <entity name='bericht'
                    query="select kategorie_full.l_id, n_id, k_dateshow, k_datevon, week(k_datevon) AS week, month(k_datevon) as month, year(k_datevon) as year, t_id, k_keywords, l_lochirarchietxt, l_lochirarchieids from kategorie_full, location where kategorie_full.l_id = location.l_id and tr_id in (${trip.tr_id}) order by k_datevon asc"
                    deltaImportQuery="select kategorie_full.l_id, n_id, k_dateshow, k_datevon, week(k_datevon) AS week, month(k_datevon) as month, year(k_datevon) as year, t_id, l_lochirarchietxt, l_lochirarchieids from kategorie_full, location where kategorie_full.l_id = location.l_id and k_id=dih.delta.id}'"
                    deltaQuery="SELECT k_id from kategorie_full'"
                    transformer="HTMLStripTransformer,RegexTransformer"
            >
                <field column="l_id" name="loc_id_i"/>
                <field column="k_keywords" name="keywords_txt" regex="[ ]+" replaceWith=" " />
                <field column="k_datevon" name="date_dts" />
                <field column="n_id" name="news_id_i"/>
                <field column="n_id" name="news_id_is"/>
                <field column="week" name="week_is" />
                <field column="month" name="month_is" />
                <field column="year" name="year_is" />
                <field column="t_id" name="route_id_is"/>
                <field column="l_lochirarchieids" name="loc_lochirarchie_ids_s" regex="[ ]+" replaceWith="_"/>
                <field column="l_lochirarchieids" name="loc_lochirarchie_ids_txt" regex="[ ]+" replaceWith="_"/>
                <field column="l_lochirarchietxt" name="loc_lochirarchie_s" regex="[- \/()+;\.]+(?!\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
                <field column="l_lochirarchietxt" name="loc_lochirarchie_txt" regex="[- \/()+;\.]+(?!\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
            </entity>

        </entity>

        <entity name="news"
                pk="id"
                query="select 'NEWS' as type, concat('NEWS', '_', n_id) as id, n_id, n_date, n_date as dateshow, DATE_FORMAT (n_date, GET_FORMAT(DATE, 'ISO')) as dateonly, n_headline, n_message_md, n_message_html, n_message_html as n_message_html2, concat(n_headline, ' ', n_keywords, ' ', n_message_html) as html, n_keywords from news order by n_date"
                deltaImportQuery="select 'NEWS' as type, concat('NEWS', '_', n_id) as id, n_id, n_date, n_date as dateshow, DATE_FORMAT (n_date, GET_FORMAT(DATE, 'ISO')) as dateonly, n_headline, n_message_md, n_message_html, n_message_html as n_message_html2, concat(n_headline, ' ', n_keywords, ' ', n_message_html) as html, n_keywords from news WHERE n_id='${dih.delta.id}'"
                deltaQuery="SELECT n_id from trip order by n_id'"
                transformer="HTMLStripTransformer,RegexTransformer"
        >
            <field column="id" name="id"/>
            <field column="n_id" name="news_id_i"/>
            <field column="n_id" name="news_id_is"/>

            <field column="n_headline" name="name_s" stripHTML="true" />
            <field column="n_headline" name="name_txt" stripHTML="true" />
            <field column="n_message_html" name="desc_txt" stripHTML="true" />
            <field column="n_message_md" name="desc_md_txt" stripHTML="true" />
            <field column="n_message_html2" name="desc_html_txt" />
            <field column="html" name="html_txt" />
            <field column="n_keywords" name="keywords_txt" regex="[ ]+" replaceWith=" " />
            <field column="n_date" name="dateshow_dt" />
            <field column="n_date" name="datesort_dt" />
            <field column="n_date" name="date_dt" />
            <field column="dateonly" name="dateonly_s" />
            <field column="type" name="type_s" />
            <field column="type" name="type_txt" />

            <!-- child='true' -->
            <entity name='image'
                    query="select i_id, i_date, concat(i_dir, '/', i_file) as i_url from image where k_id in (select k_id from kategorie_full where n_id in (${news.n_id})) order by I_RATE_MOTIVE desc, I_RATE_WICHTIGKEIT desc, I_RATE desc, I_ID desc limit 10"
                    deltaImportQuery="SELECT i_id, i_date, concat(i_dir, '/', i_file) as i_url from image WHERE i_id='${dih.delta.id}'"
                    deltaQuery="SELECT i_id from image'"
            >
                <field column="i_id" name="i_fav_id_is" />
                <field column="i_date" name="i_fav_i_date_dts" />
                <field column="i_url" name="i_fav_url_txt" />
            </entity>
            <entity name='tour'
                    query="select t_id, t_keywords, concat('ac_', tour.t_typ) as actiontype from tour where t_id in (select t_id from kategorie_full where n_id in (${news.n_id}))"
                    deltaImportQuery="select t_id, t_keywords from tour where t_id='${dih.delta.id}'"
                    deltaQuery="SELECT t_id from tour'"
            >
                <field column="actiontype" name="actiontype_s" />
                <field column="actiontype" name="actiontype_ss" />
            </entity>
            <entity name='bericht'
                    query="select kategorie_full.l_id, n_id, k_dateshow, k_datevon, week(k_datevon) AS week, month(k_datevon) as month, year(k_datevon) as year, t_id, k_keywords, l_lochirarchietxt, l_lochirarchieids from kategorie_full, location where kategorie_full.l_id = location.l_id and n_id in (${news.n_id}) order by k_datevon asc"
                    deltaImportQuery="select kategorie_full.l_id, n_id, k_dateshow, k_datevon, week(k_datevon) AS week, month(k_datevon) as month, year(k_datevon) as year, t_id, l_lochirarchietxt, l_lochirarchieids from kategorie_full, location where kategorie_full.l_id = location.l_id and k_id=dih.delta.id}'"
                    deltaQuery="SELECT k_id from kategorie_full'"
                    transformer="HTMLStripTransformer,RegexTransformer"
            >
                <field column="l_id" name="loc_id_i"/>
                <field column="k_keywords" name="keywords_txt" regex="[ ]+" replaceWith=" " />
                <field column="k_datevon" name="date_dts" />
                <field column="week" name="week_is" />
                <field column="month" name="month_is" />
                <field column="year" name="year_is" />
                <field column="t_id" name="route_id_is"/>
                <field column="l_lochirarchieids" name="loc_lochirarchie_ids_s" regex="[ ]+" replaceWith="_"/>
                <field column="l_lochirarchieids" name="loc_lochirarchie_ids_txt" regex="[ ]+" replaceWith="_"/>
                <field column="l_lochirarchietxt" name="loc_lochirarchie_s" regex="[- \/()+;\.]+(?!\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
                <field column="l_lochirarchietxt" name="loc_lochirarchie_txt" regex="[- \/()+;\.]+(?!\\n)|(([a-zA-Z0-9 _]),{1,1}(?!,))|(^ ,{1,1}(?!,))" replaceWith="$2_"/>
            </entity>
        </entity>
    </document>

</dataConfig>